<!--Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE HTML>
<html>

<head>
    <title>My cart</title>
    <link rel="stylesheet" href="{{url_for('.static', filename='css/cart/style.css')}}">
    <link rel="stylesheet" href="{{url_for('.static', filename='css/cart/font.css')}}">
    <style>
        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
    <!-- Custom Theme files -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords"
        content="Flat Cart Widget Responsive, Login form web template, Sign up Web Templates, Flat Web Templates, Login signup Responsive web template, Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
    <!--google fonts-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="{{url_for('.static', filename='jquery/jquery.validate.min.js')}}"></script>
</head>

<body>
    <div class="logo">
        <h3>Book Shop</h3>
    </div>
    <div class="cart">
        <div class="cart-top">
            <div class="cart-experience">
                <h4>Shopping Cart</h4>
            </div>

            <div class="clear"> </div>
        </div>
        <div class="cart-bottom">
            <div class="table">
                <table>
                    <tbody id="list">
                        <tr class="main-heading">
                            <th>Images</th>
                            <th class="long-txt">Product Description</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>

                    </tbody>
                </table>
            </div>
            <div class="vocher">
                <div class="dis-card">
                    <h2>Discount Code or Voucher</h2>
                    <p>Enter your discount code or voucher to receive a discount on your total order.</p>
                    <form>
                        <input type="text" value="">
                        <input type="submit" value="Redeem">
                    </form>
                </div>
                <div class="dis-total">
                    <h1>Total $38.97</h1>
                    <div class="tot-btn">
                        <a class="shop" href="#">Back to Shop</a>
                        <a class="check" href="#">Continue to Checkout</a>
                    </div>
                </div>
                <div class="clear"> </div>
            </div>
        </div>
    </div>
    <script src="{{url_for('.static', filename='js/getCookie.js')}}"></script>
    <!-- <script>$(document).ready(function (c) {
            $('.close').on('click', function (c) {
                $('.cake-top').fadeOut('slow', function (c) {
                    $('.cake-top').remove();
                });
            });
        });
    </script>

    <script>$(document).ready(function (c) {
            $('.close-btm').on('click', function (c) {
                $('.cake-bottom').fadeOut('slow', function (c) {
                    $('.cake-bottom').remove();
                });
            });
        });
    </script> -->

    <script>

        $(document).ready(function () {
            var json_str = getCookie('cart');
            var arr = JSON.parse(json_str);
            for (i in arr) {
                $.ajax({
                    url: '/book/get-detail-book-cart',
                    dataType: 'json',
                    method: 'POST',
                    data: {
                        'id': arr[i].id,
                        'count': arr[i].count
                    },
                    success: function (aData) {
                        var sHtml = `
                        <tr class="cake-top" id="element`+ aData.id + `">
                            <td class="cakes">
                                <div class="product-img">
                                    <a href="/book/`+ aData.slug + `"><img src="../static/images/books/` + aData.image + `"  width="600"></a>
                                </div>
                            </td>
                            <td class="cake-text">
                                <div class="product-text">
                                    <a href="/book/`+ aData.slug + `"><h1>` + aData.title + `</h1></a>
                                    <p>Available: `+ aData.number + `</p>
                                </div>
                            </td>
                            <td class="quantity">
                                <div class="product-right">
                                    <input min="1" type="number" id="quantity" name="quantity`+ aData.id + `" value="` + aData.count + `"
                                        class="form-control input-small" pattern="/^-?\d+\.?\d*$/" onKeyPress="if (this.value.length == 10) return false;" onkeydown="javascript: return event.keyCode === 8 ||
                                                    event.keyCode === 46 ? true : !isNaN(Number(event.key))">
                                </div>
                            </td>
                            <td class="price">
                                <div style="display: flex;"><h4>$</h4><h4 class="">`+ aData.price + `</h4></div>
                            </td>
                            <td class="top-remove">
                                <div style="display: flex;"><h4>$</h4><h4>`+ aData.total + `</h4></div>
                                <div class="close" id="`+ aData.id + `">
                                    <h5>Remove</h5>
                                </div>
                            </td>

                        </tr>
                        `;
                        $('#list').append(sHtml);

                        $('#' + aData.id).click(function () {
                            $('#element' + aData.id).fadeOut('slow', function () {
                                $('#element' + aData.id).remove();
                            });

                            //change cookie
                            var json_str = getCookie('cart');
                            var arr = JSON.parse(json_str);
                            for (i in arr) {
                                if (arr[i].id == aData.id) {
                                    arr.splice(i, 1);
                                    break;
                                }
                            }
                            var json_str = JSON.stringify(arr);
                            document.cookie = "cart=" + json_str + '; path=/';
                        });

                        $('input[name="quantity' + aData.id + '"]').focusout(function () {
                            if ($(this).val() == 0) $(this).val(1);

                            //change cookie
                            var json_str = getCookie('cart');
                            var arr = JSON.parse(json_str);

                            for (i in arr) {
                                if (arr[i].id == aData.id) {
                                    arr[i].count = $(this).val();
                                    break;
                                }
                            }
                            var json_str = JSON.stringify(arr);
                            document.cookie = "cart=" + json_str + '; path=/';
                        });
                    },
                    error: function () {
                        alert('error');
                    },
                    beforeSend: function () {
                        $('#loading').css('display', 'block');
                    },
                    complete: function () {
                        $('#loading').css('display', 'none');
                    }
                });
            }
        });

    </script>
</body>

</html>