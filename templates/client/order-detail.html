<!DOCTYPE HTML>
<html>

<head>
    <title>Order detail</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <link rel="stylesheet" href="{{url_for('.static', filename='css/cart/style1.css')}}">
    <link rel="stylesheet" href="{{url_for('.static', filename='css/cart/font.css')}}">
    <style>

    </style>
    <!-- Custom Theme files -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords"
        content="Flat Cart Widget Responsive, Login form web template, Sign up Web Templates, Flat Web Templates, Login signup Responsive web template, Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
    <!--google fonts-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="{{url_for('.static', filename='jquery/jquery.validate.min.js')}}"></script>
    <link rel="stylesheet" href="{{url_for('.static', filename='css/home/progress.css')}}">
</head>

<body>
    <div id="loading"><i class="fa fa-spinner fa-3x fa-spin"></i>
    </div>
    <input type="hidden" id="id" value="{{ id }}">
    <div class="logo">
        <h3>Book Shop</h3>
    </div>
    <div class="cart">
        <div class="cart-top">
            <div class="cart-experience">
                <h4>Shopping Cart</h4>
            </div>

            <div class="clear"> </div>
        </div>
        <div class="cart-bottom">
            <div class="table">
                <table>
                    <tbody id="list">
                        <tr class="main-heading">
                            <th>Images</th>
                            <th class="long-txt">Product Description</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>

                    </tbody>
                </table>
            </div>
            <div id="info">
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Name:</b>
                    </div>
                    <div style="width: 70%;" id="name">
                    </div>
                </div>
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Email:</b>
                    </div>
                    <div style="width: 70%;" id="email">

                    </div>
                </div>
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Address:</b>
                    </div>
                    <div style="width: 70%;" id="address">
                    </div>
                </div>
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Phone number:</b>
                    </div>
                    <div style="width: 70%;" id="phone">
                    </div>
                </div>
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Payment method:</b>
                    </div>
                    <div style="width: 70%;" id="method">
                    </div>
                </div>
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Status:</b>
                    </div>
                    <div style="width: 70%;" id="status">
                    </div>
                </div>
                <div class="row" style="margin-top: 5px; margin-bottom: 5px; display: flex;">
                    <div style="width: 30%;">
                        <b style="font-weight: bold;">Created:</b>
                    </div>
                    <div style="width: 70%;" id="created">
                    </div>
                </div>
            </div>
            <div id="input-otp">
            </div>
            <div class="vocher" style="padding: 10px; border-top: 3px solid #CCCCCC;">
                <div class="dis-card">
                    <h2>Discount Code or Voucher</h2>
                    <form id="form-coupon">
                        <input type="text" value="" name="code" id="code" disabled>
                    </form>
                    {% if admin == True: %}
                    <h2>Status</h2>
                    <select class="form-control" id="status-order" name="status-order" style="font-size: 16px;">
                        <option value="To pay">To pay</option>
                        <option value="To ship">To ship</option>
                        <option value="Completed">Completed</option>
                    </select>
                    {% endif %}
                </div>
                <div class="dis-total">
                    <h1 id="total"></h1>
                    <div class="tot-btn">
                        {% if admin == False: %}
                        <a class="check" href="javascript:void(0)" id="cancel">Cancel Order</a>
                        {% endif %}

                        <a class="shop" href="/">Back to Shop</a>
                    </div>
                </div>
                <div class="clear"> </div>
            </div>
        </div>
    </div>
    <script src="{{url_for('.static', filename='js/getCookie.js')}}"></script>
    {% if admin == False: %}
    <script src="{{url_for('.static', filename='js/orders/_detail_.js')}}"></script>
    {% else: %}
    <script>
        $('#status-order').change(function () {
            $.ajax({
                url: '/order/set-status',
                dataType: 'json',
                method: 'POST',
                data: {
                    'id': $('#id').val(),
                    'status': $(this).val()
                },
                headers: {
                    "Authorization": "Bearer " + getCookie('token'),
                },
                success: function (aData) {
                    alert(aData.message);
                    location.reload();
                },
                error: function () {
                    alert('error');
                },
                beforeSend: function () {
                    $('#loading').css('display', 'block');
                },
                complete: function () {
                    $('#loading').css('display', 'none');
                }
            });
        });
        $(document).ready(function () {
            $.ajax({
                url: '/admin/get-user-info',
                dataType: 'json',
                method: 'POST',
                data: {
                    'id': $('#id').val()
                },
                headers: {
                    "Authorization": "Bearer " + getCookie('token'),
                },
                success: function (aData) {
                    $('#name').html(aData.firstname + ` ` + aData.lastname);
                    $('#email').html(aData.email);
                    $('#address').html(aData.address);
                    $('#phone').html(aData.phone);
                },
                error: function () {
                    alert('error');
                },
                beforeSend: function () {
                    $('#loading').css('display', 'block');
                },
                complete: function () {
                    $('#loading').css('display', 'none');
                }
            });

            $.ajax({
                url: '/order/admin/get-detail-order',
                dataType: 'json',
                method: 'POST',
                data: {
                    'id': $('#id').val()
                },
                headers: {
                    "Authorization": "Bearer " + getCookie('token'),
                },
                success: function (aData) {
                    var list_book = JSON.parse(aData.order_info.order)
                    for (i in list_book) {
                        fGetDataBook(list_book[i].id, list_book[i].count);
                    }
                    $('#code').val(aData.order_info.coupon.code);
                    $('#total').html('Total: $' + aData.order_info.total);
                    $('#method').html(aData.method);
                    $('#status').html(aData.status);
                    $('#status-order').val(aData.status);
                    $('#created').html(aData.created);
                },
                error: function () {
                    alert('error');
                },
                beforeSend: function () {
                    $('#loading').css('display', 'block');
                },
                complete: function () {
                    $('#loading').css('display', 'none');
                }
            });
        });
        function fGetDataBook(id, count) {
            $.ajax({
                url: '/book/get-detail-book-cart',
                dataType: 'json',
                method: 'POST',
                data: {
                    'id': id,
                    'count': count
                },
                success: function (aData) {
                    var sHtml = `
                <tr class="cake-top" id="element`+ aData.id + `">
                    <td class="cakes">
                        <div class="product-img">
                            <a href="/book/`+ aData.slug + `"><img src="../static/images/books/` + aData.image + `"  width="150" height="auto"></a>
                        </div>
                    </td>
                    <td class="cake-text">
                        <div class="product-text">
                            <a href="/book/`+ aData.slug + `"><h1>` + aData.title + `</h1></a>
                            <p>In stock: `+ aData.number + `</p>
                        </div>
                    </td>
                    <td class="quantity">
                        <div class="product-right">
                            <p>` + aData.count + `</p>
                        </div>
                    </td>
                    <td class="price">
                        <div style="display: flex;"><h4>$</h4><h4 id="price`+ aData.id + `">` + aData.price + `</h4></div>
                    </td>
                    <td class="top-remove">
                        <div style="display: flex;"><h4>$</h4><h4 id="total`+ aData.id + `">` + aData.total + `</h4></div>
                    </td>

                </tr>
                `;
                    $('#list').append(sHtml);
                },
                error: function () {
                    alert('error');
                },
                beforeSend: function () {
                    $('#loading').css('display', 'block');
                },
                complete: function () {
                    $('#loading').css('display', 'none');
                }
            });
        }
    </script>
    {% endif %}

</body>

</html>